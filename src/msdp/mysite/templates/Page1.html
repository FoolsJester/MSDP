<!DOCTYPE html>
<html lang="en">
    
<!-- Google API Key = AIzaSyBS6Ca0PFx3eydXjgD17aQogUFe8jeOfqg -->
<!-- AccuWeather API Key = em8jLMl8jkAqrLiuJM0BCBQEoxHfJAJq -->
{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'Page1.css' %}" />


    <head>
        
        <!-- Use utf-8 encoding -->
        <meta charset="utf-8">
        
        <!-- Tell Internet Explorer or Edge use the latest rendering engine -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        
        <!-- Set the page width to the size of the device, set zoom to 1 -->
        <meta name="viewport" content="width = device-width, initial-scale = 1">
           
        <title> Page 1 </title>
           
        <!-- Bootstrap CDN for CSS, found on getbootstrap.com -->
        <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
        
        <!-- Bootstrap CDN for JQuery, found on getbootstrap.com  -->    
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
            
    </head>
    
    <body class="bg-secondary">
        
        
        <!-- Navigation Bar -->
        
        <nav class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top">
            
            <div class="container">
            
               <a href="http://localhost:8000/dublinbus/" class="navbar-brand"> <strong>Team DPSM</strong> </a> 
                
                <button class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                    
                </button>
                
                <div class="collapse navbar-collapse" id="navbarCollapse">
                
                    <ul class=navbar-nav ml-auto>
                    
                        <li id="plemx-root" class="nav-item">
                         
                            
                            <a href="http://www.theweathernetwork.com">The Weather Network</a>
                            <script type="text/javascript"> 

                              var _plm = _plm || [];
                              _plm.push(['_btn', 82501]); 
                              _plm.push(['_loc','eixx0014']);
                              _plm.push(['location', document.location.host ]);
                               (function(d,e,i) {
                              if (d.getElementById(i)) return;
                              var px = d.createElement(e);
                              px.type = 'text/javascript';
                              px.async = true;
                              px.id = i;
                              px.src = ('https:' == d.location.protocol ? 'https:' : 'http:') + '//widget.twnmm.com/js/btn/pelm.js?orig=en_ca';
                              var s = d.getElementsByTagName('script')[0];

                              var py = d.createElement('link');
                              py.rel = 'stylesheet'
                              py.href = ('https:' == d.location.protocol ? 'https:' : 'http:') + '//widget.twnmm.com/styles/btn/styles.css'

                              s.parentNode.insertBefore(px, s);
                              s.parentNode.insertBefore(py, s);
                            })(document, 'script', 'plmxbtn');
                            
                            </script>

                        
                        </li>
                    
                    
                    
                    </ul>
                
                </div>
            </div>
            
        </nav>
        
        
        
        <!-- Container -->
        <div id="containsAll" class="mt-5 pt-5">
            
            
            <!-- Row to keep map and input on the same line -->
            <div class="row" col-xl-3 col-lg-3 col-md-6 col-sm-12 col-xs-12>
               
                
                <!-- Found online, have used it before for WebApp Assignment2 -->
                <!--The div element for the map -->
                <div id="map"></div>

                    <script>
                        // Initialize and add the map
                        function initMap() {
                                // The location of Dublin
                                var Dublin = {lat: 53.3351, lng: -6.2493};
                                // The map, centered at Dublin
                                var map = new google.maps.Map(
                                  document.getElementById('map'), {zoom: 10, center: Dublin});
                              // The marker, positioned at Dublin
                              //var marker = new google.maps.Marker({position: Dublin, map: map});
                            }
                    </script>
                    <!--Load the API from the specified URL
                    * The async attribute allows the browser to render the page while the API loads
                    * The key parameter will contain your own API key (which is not needed for this tutorial)
                    * The callback parameter executes the initMap() function
                    -->
                    <script async defer
                        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBS6Ca0PFx3eydXjgD17aQogUFe8jeOfqg&callback=initMap">
                    </script>
                    
                    <!-- Jumbotron to hold the form -->
                    <div class="jumbotron bg-primary border border-white pt-1 pb-1">
                    
                     <!-- The FORM -->
                     <form class="bg-infoml-5">
                                
                        <!-- Start -->
                        <div class="form-group p-2">
                            <label for="start" class="text-white blockquote">Start:</label>
                            <input id="start" type="text" class="float-none text-dark form-control" placeholder="Start Bus Stop ID">
                        </div>
                                
                        <!-- Destination -->
                        <div class="form-group p-2">
                            <label for="destination" class="text-white blockquote" >Destination:</label>
                            <input id="destination" type = "text" class="float-none text-dark form-control" placeholder="Destination Bus Stop ID">
                        </div>
                               
                        <!-- Date -->
                        <div class="form-group p-2">
                            <label for="date" class="text-white blockquote">Date:</label>
                            <span style="display:inline-block; width:2rem;"></span>
                            <input type="date" id = "date"  class="float-none text-dark form-control">
                        </div> 
                           
                           
                        <!-- Time -->
                        <div class="form-group p-2 mb-5"> 
                            <label for="time" class="text-white blockquote">Time:</label>
                            <span style="display:inline-block; width:3rem;"></span>
                            <input type ="time" id="time" class="float-none text-dark form-control">
                        </div>
                            
                        
                                
                        <!-- Submit -->
                        <div class="form-group p-2">
                            <span style="display:inline-block; width:3rem;"></span>
                            <button id="submit" value="Submit" class="text-dark btn btn-active btn btn-light">Submit</button>
                            <!-- <button id="submit" value="Submit" class="text-light btn btn-active">Submit</button> -->                     
                        </div>
                    
                           
                    </form>
                    </div>
                    
                    <!-- Jumbotron to hold Search Results and Details -->
                    <div class="jumbotron bg-primary pt-1 pb-1 border border-white">
                    
                        <div id='routes'>Result area</div>
                                
                    </div>  
                </div>
                
            
                <!-- Footer for the application -->
                <footer id="main-footer" class=" mb-0 bg-dark text-white fixed-bottom">
                    
                    <div class="container">
                    
                        <div class="row text-center">
                        
                            <div class="col-md-6 ml-auto">
                            
                            <p class="lead">
                            
                                Copyright &copy; <span id="year"></span>
                                
                            </p>
                            
                            
                            </div>
                        
                        </div>
                    
                    </div>
            
                </footer>
            
    
            </div>
        
        
        
        
        
                
   <!-- End of Body, Script area -->         
    
    <!-- Script Variables need to change or script will not work, class needs to change (maybe id or name?) @Dan Zhu -->
        <script>
        $(function(){
            $(".bg-infoml-5").submit(function(evt){
                evt.preventDefault();
                sub();
            });
        });
        function sub()
            {
                var start=$("#start").val();
                var end=$("#destination").val();
                var date=$("#date").val();
                var time=$("#time").val();
                var timenumber=time.split(":");
                var seconds=Number(timenumber[0])*60*60 + Number(timenumber[1])*60;
                data_to_backend = {'Start':start,'End':end,'Time':seconds,'Date':date}; 

                $.post("/dublinbus/form_input/", data_to_backend, function(data){
                    data=JSON.parse(data);
                    str=showRoutes(data);
                    document.getElementById('routes').innerHTML = str;
                })
                .fail(function() {
                    alert( "Connection fail, please refresh the website." );
                });
                
            }
            
        function showRoutes(json){
                var str='';
                var findRoute=false;
                for (var i in json) {
                    if (parseInt(json[i]['traveltime'])>0){
                        str+="<div class='route-div' style='border:#FFFFFF 1px ridge; margin-bottom:-14%; padding:0;'>"+"<div class='route-div-detail'><img src='/static/icon/bus.png'>"+json[i]['line']+'</div>'+'Next Bus: '+converToHour(parseInt(json[i]['pairarrtime'][0]))+'<br>'+'Time to Dest: '+Math.round(json[i]['traveltime']/60)+' min'+'</div><br>';
                        findRoute=true;
                    }
                }
            
                if (!findRoute)
                    str='No bus route!!'

                return str;
            }
            
        function converToHour(a){
                var hours=parseInt(a/3600);
                var mins=parseInt((a-hours*3600)/60);
                var time='';
                if (hours<10)
                    hours='0'+hours;
                if (mins<10)
                    time=hours+':0'+mins;
                else
                    time=hours+':'+mins;
                return time;
        }
            
        $(function(){    
            $("#route-div-detail").bind("click",function(){
                alert("Yes");
            });
        });

        </script>
        
        <!-- Bootstrap CDN for Javascript, found on getbootstrap.com -->
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous">
        </script>  
                 
        
        <!-- Get current year -->
        
        <script>
        
        $('#year').text(new Date().getFullYear());
        
        </script>
        
    </body>
</html>
               
            
            
        
    
    
